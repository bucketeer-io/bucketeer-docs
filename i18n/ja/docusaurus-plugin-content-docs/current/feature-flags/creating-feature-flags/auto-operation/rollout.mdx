---
title: ロールアウト
slug: /feature-flags/creating-feature-flags/auto-operation/rollout
description: Bucketeer でロールアウト機能がどのように機能するかを確認する
tags:
  - guide
  - automation
  - rollout
  - feature-flag
---

import CenteredImg from '@site/src/components/centered-img/CenteredImg';

このロールアウトソリューションは、ユーザーに新機能を徐々に提供するように設計されています。 リリースプロセスを自動化し、ユーザのより多くの割合で選択したフラグのバリエーションを徐々に提供して、期待どおりに動作するようにします。 このアプローチを使用して、問題を検出し、初期段階での影響を軽減できます。

ロールアウトオプションを使用すると、format@@0(/feature-flags/creating-feature-flags/auto-operation) から有効にする操作を選択します。 つまり、時間が経つにつれて、より多くのユーザーが受け取るフラグのバリエーションを選択し、ロールアウトがその終わりに近づくことを意味します。

## 要件と制限

ロールアウト機能を使用するには、いくつかの要件を満たす必要があります。 そうしないと、設定できなくなります。 以下のリストは、ロールアウトの作成に関連する制限をまとめています。

-   ロールアウトは、2 つのバリエーションを持つフラグでのみ機能します。 より多くのバリエーションのあるフラグで使用しようとすると、送信時にエラーメッセージが表示されます。
-   [Prerequisites](/feature-flags/creating-feature-flags/targeting#requirements), [Targets](/feature-flags/creating-feature-flags/targeting#targeting)または [Rules](/feature-flags/creating-feature-flags/targeting#rollout-percentage) を含むフラグにロールアウトを追加することはできません。
-   ロールアウトを追加するには、機能フラグがアクティブである必要があります。

フラグタイプには制限はありません。 つまり、ロールアウト機能はすべて[feature flag types](/feature-flags/creating-feature-flags/create-feature-flag#feature-flags-types)で使用できます。

## ロールアウトの仕組み

このロールアウト機能は、2つのバリエーションフラグで動作するように設計されています。 すべてのユーザーが利用できるようになるまで、より大きなユーザーグループで既存のバリエーションを徐々に利用できるようにすることができます。 

ロールアウト機能の仕組みを理解するために、`true`と`false`バリエーションのブールフラグを考えてみましょう。 新しいコンテンツが利用可能かどうかを定義します。 現在、`false` バリエーションは format@@0(/feature-flags/creating-feature-flags/targeting#the-targeting-page) です。つまり、ユーザーは新しいコンテンツを見ることができません。 しかし、コンテンツは起動する準備ができており、10日間ですべてのユーザーが利用できるようにしたいと考えています。 このシナリオでは、ロールアウト機能を使用して、毎日10%で徐々に`true`バリエーションを展開することができます。 ロールアウトの初日に、ユーザーの10%が新しいコンテンツを表示します。 2日目までに20%が見れるようになります 10日後、ロールアウトが完了し、すべてのユーザーが新しいコンテンツにアクセスできるようになります。 以下の画像は、展開プロセスをまとめたものです。

<CenteredImg
  imgURL="img/feature-flags/auto-ops-rules/rollout.png"
  alt="Rollout example"
  wSize="550px"
  borderWidth="1px"
/>

## Configuring a rollout

機能フラグにロールアウトを追加するには、以下の手順に従う必要があります。

1.  **自動操作** ページに移動します。
2.  "参加"ボタンを押下します。
3.  オペレーション設定パネルが表示されます。 目的のオペレーションを選択します。
4.  選択してください：**プログレッシブ・ロールアウト**。
5.  ロールアウトを設定します。
6.  **提出**をクリックします。 

ロールアウトには以下の2つの主要なオプションがあります:

-   **テンプレート**: このオプションでは、ロールアウトのパーセンチュアル増分と頻度を定義します。 各フェーズの重量と実行時間は、ロールアウトが100%になるまで自動的に定義されます。
-   **マニュアル**: この場合、各ロールアウトフェーズの重量と解放時間を定義する責任があります。

### テンプレート展開

テンプレートのロールアウトを選択した場合、送信する前に次の設定を定義する必要があります。

-   **バリエーション**: 展開するバリエーションを選択します。 format@@0(/feature-flags/creating-feature-flags/targeting#the-targeting-page) と同じバリエーションを選択しないでください。 そうでなければ、エラーメッセージが表示されます。
-   **開始日**: 開始日時。 
-   **インクリメント**: リリース段階ごとに使用されるパーセンチュアルインクリメント。 このオプションは、結果として、ロールアウトリリースの合計数を定義します。 10%を選択すると、10のステージが合計ロールアウトに到達する必要があります。
-   **周波数**: 各ロールアウトフェーズ(毎時、毎日、毎週)の周波数が解放されます。 最初のフェーズは、選択した**開始日**の値に依存します。残りのフェーズは、この開始点に依存します。 

テンプレートのロールアウト時に注意してください。 すべてのフェーズでは、**インクリメント**パラメータで定義された、新しいバリエーションにアクセスするユーザーの割合が増加します。 以下の画像は、テンプレート構成を使用した構成の例をまとめたものです。

<CenteredImg
  imgURL="img/feature-flags/auto-ops-rules/template-rollout.png"
  alt="Template rollout"
  wSize="400px"
  borderWidth="1px"
/>

### マニュアル展開

マニュアルロールアウトを使用する場合、ロールアウトを提出するために必要な構成は、テンプレートロールアウトで使用される構成とは異なります。 この場合、次のパラメータを設定する必要があります。

-   **バリエーション**: 展開するバリエーションを選択します。 format@@0(/feature-flags/creating-feature-flags/targeting#the-targeting-page) と同じバリエーションを選択しないでください。 そうでなければ、エラーメッセージが表示されます。
-   **重み**: 選択した日付で選択したバリエーションを受け取ったユーザーのパーセンチュアルな値。 
-   **実行**：ロールアウトフェーズがリリースされる日時、選択したバリエーションにアクセスするユーザーの割合を更新します。

マニュアルのロールアウトを使用すると、各ロールアウトフェーズの増分ルールに従う必要はありません。 唯一の制限は、新しい展開フェーズごとに以前のものよりも高い重量を持つ必要があることです。 

マニュアルオプションに関連するもう一つの重要な点は、ロールアウトを提出するために100%に達する必要がないことです。 手動設定の最後のエントリが 90% であるとします。 この場合、ロールアウトは終了し、新しいバリエーションにアクセスできるのはユーザーの90%に過ぎません。 残りの10%は、ロールアウト前と同じformat@@0(/feature-flags/creating-feature-flags/targeting#the-targeting-page)を受け取り続けます。

以下の画像は、テンプレート構成を使用した構成の例をまとめたものです。

<CenteredImg
  imgURL="img/feature-flags/auto-ops-rules/manual-rollout.png"
  alt="Template rollout"
  wSize="400px"
  borderWidth="1px"
/>
